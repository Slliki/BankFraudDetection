# Data Description

## 1. Fairness and Bias in Financial Services
因为模型预测会导致向个人提供或拒绝金融服务，这可能会加剧现有的社会不平等。例如，持续拒绝一个群体的个人获得信贷可能会延续甚至扩大现有的财富不平等差距。套件中的每个数据集变体都具有多个时间步的预定和受控类型的数据偏差，详细信息见第3.3节。上述变量与底层数据分布固有的时间分布变化相结合，构成了一种创新的媒介，用于压力测试在动态环境中运行的ML模型的性能和公平性。

数据集是利用最先进的生成对抗网络(GAN)模型生成的[21]。选择这些方法的一个重要原因是考虑到申请人的隐私

### 1.1 Selective Labeling
在金融数据中，获取到的数据集很大程度上都是经过预筛选的。比如，如果一个申请者通过了贷款申请，他的后续行为会被记录下来，比如是否按时还款。如果这个申请者按时还款，他的标签可能是“信用良好”；如果他没有按时还款，标签可能是“信用不良”。
对于在申请过程中被拒绝的申请者，我们没有后续的行为数据。这意味着我们无法知道这些申请者是否本来会按时还款或者是否会欺诈。

由于只有通过预筛选的申请者才有标签数据，这导致数据集不完整。缺乏关于被拒绝申请者的标签信息会影响模型的训练和预测性能。

尽量减少预筛选的影响：

在创建该数据集的时候考虑到了这一点，在我们的案例中，预筛选过程是最小的，仅包括监管检查(例如，反洗钱法规可能不允许银行接受某些客户)，以及针对所提供信用卡的专门面向业务的检查(仅限银行运营的特定国家的18岁以上居民)。因此，尽管由于银行监管，一些选择偏差是严格不可避免的，但该数据集包含了尽可能广泛的申请人。

### 1.2 Privacy
对于生成数据集，必须考虑到隐私性。这套数据集采用了在GAN训练之前向原始数据添加噪声机制[41]。通过这种方式，GAN永远无法访问特定的申请人数据。我们对我们的数据集套件采用这种方法，因为以前的方法不会输出在实践中有用的足够信息的数据。

文章中描述了生成最终数据集的过程，主要包括以下几个步骤：

![Alt text](../imgs/GeneratingDataProcedure.png)

1. **原始数据集准备**：
   - 使用来自一家大型消费银行的在线银行账户开设欺诈检测数据。数据覆盖八个月，包含大约一百万条申请记录，每条记录有30个特征。

2. **特征选择**：使用LightGBM模型进行特征选择。
   - 通过训练200个不同超参数配置的LightGBM模型，选择出五个最佳模型。
   - 使用这些模型的重要性评分，选择出前30个重要特征。
   - 进一步手动筛选特征，确保选出的特征表达性强、解释性好，并且冗余少。

3. **隐私保护**：
   - 在训练生成对抗网络（GAN）之前，对原始数据进行噪声添加和特征分类，以确保数据隐私。
   - 将年龄和收入等敏感特征进行分类处理，并使用拉普拉斯噪声机制扰动数据，以实现差分隐私保护。

4. **生成对抗网络（GAN）训练**：使用CTGAN模型生成数据。
   - 使用CTGAN模型在扰动后的数据上进行训练。
   - 通过添加一个表示申请月份的列，使GAN能够捕捉时间动态特征。
   - 使用随机搜索选择GAN模型的超参数，共训练了70个CTGAN模型，每个模型的训练时间大约为4.53小时。

5. **生成数据样本**：
   - 从训练好的GAN模型中生成250万个实例。
   - 通过进一步抽样，确保生成的数据在月份分布和欺诈率上与原始数据相匹配，生成最终包含100万个实例的数据集。

6. **数据集变体的生成**：
   - 基于生成的基础数据集，创建了六个包含特定数据偏差的变体。具体偏差包括组大小差异、流行率差异、可分离性差异，以及这些偏差随时间的变化。
   - 每个变体的数据集都用于测试不同的机器学习模型在性能和公平性上的表现。

7. **性能和公平性评估**：
   - 使用LightGBM模型对生成的数据进行性能和公平性评估。
   - 评估指标包括在5%假阳性率下的真阳性率（TPR）以及预测平等性（FPR比率）。

总之，文章通过特征选择、隐私保护、GAN训练和多样化数据集生成的过程，最终生成了一套大规模、隐私保护、现实的银行账户开设欺诈检测数据集，用于评估机器学习模型的性能和公平性。

### 1.4 Variants of Data
为了测试生成模型在预测性能和公平性方面的表现，对数据集进行的特定偏差引入和控制。通过引入组大小差异、流行率差异和可分离性差异，生成了六个变体数据集，使得模型在训练和测试过程中能够处理不同的偏差模式，从而提高其泛化能力。

### Group Size disparity
该研究以`customer_age`作为group size的分类标准，当年龄<=50,作为Majority，否则作为Minority。
其中`customer_age`表示申请人的年龄组，如customer_age=20表示20-29.
因此使用`customer_age`<=40(10-49)作为Majority；`customer_age`>40(50+)作为Minority。

### Prevalence disparity
在本研究中，prevalence 指的是不同年龄群体中的欺诈率。比如对于Base，Majority的欺诈率为0.9；Minority为1.8

### Separability disparity
可分离性差异意味着特征和标签之间的关系在不同的受保护属性群体中存在显著差异。某些群体的分类任务由于特征和标签之间的强关联性变得更简单，而另一些群体的分类任务则更复杂。文献中的示例说明了如何通过引入特定的环境条件（如ATM光照情况）来表现出这种差异，从而影响不同群体的欺诈识别效果。

存在可分离性差异的数据集（3和5),会多出两列（x1，x2）
- 添加特征：通过附加两列具有不同多元正态分布的特征，这些特征的均值依赖于群体和标签，并具有不同的可控线性可分离性。
- 操纵相关性：在数据生成过程中，调整特征与标签之间的相关性，使得多数群体的分类任务变得更容易，而少数群体的分类任务则保持不变。


## Description of the Datasets

![Alt text](../imgs/datasets.png)

#### Base
- **群体大小**：Majority占77%，Minority占23%。
- **欺诈率差异**：Majority的欺诈率0.9；Minority的欺诈率1.8。
- **描述**：这是一个基本的数据集，用于测试模型在面对群体大小和欺诈率差异时的性能。这种类型的偏差是欺诈检测中最常见的，因此是一个很好的起点。

#### 变体 I (Variant I)
- **群体大小差异**：相比基础数据集和原始数据集，该变体中受保护属性群体（如年龄群体）没有显著的欺诈率差异。相反，群体大小差异被加剧，使少数群体的比例从大约20%减少到10%。
- **欺诈率差异**：没有差异，两个群体的欺诈率均衡。
- **描述**：尽管模型不再面临群体间的欺诈率不平衡问题，但由于少数群体比例更小，模型必须能够应对可能被低估的少数群体。

#### 变体 II (Variant II)
- **群体大小**：群体大小相等，各占50%。
- **欺诈率差异**：一个群体的欺诈率是另一个群体的五倍，而不是基础数据集中的两倍。
- **描述**：用于测试欺诈率差异偏差对模型的影响，这是一个更具挑战性的偏差测试。

#### 变体 III (Variant III)
- **群体大小**：群体大小相等，各占50%。
- **欺诈率差异**：没有差异，两个群体的欺诈率均衡。
- **可分离性差异**：存在，通过操纵受保护属性、附加特征和目标变量之间的相关性，使得多数群体的分类任务变得相对简单。
- **描述**：这种类型的偏差需要更细致的干预措施，例如重新采样数据以平衡欺诈率和群体大小无效。因此，为了在这种变体下保持模型的公平性和性能，重要的是在抵消某些特征和受保护属性之间的关系与学习有用模式之间找到平衡。

#### 变体 IV (Variant IV)
- **群体大小**：群体大小相等，各占50%。
- **欺诈率差异**：前六个月存在欺诈率差异，但在剩余时间内没有差异。
- **描述**：引入了时间方面的数据偏差，前六个月的数据用于训练，剩余时间的数据用于验证。观察到的差异可能是由于训练数据收集过程中的偏差引起的。考虑到这些方面对于模拟现实中的数据集变体至关重要，因为现实世界中的应用程序容易受到实践者无法立即控制的偏差的影响，并且随着时间的推移会发生变化。

#### 变体 V (Variant V)
- **群体大小**：群体大小相等，各占50%。
- **欺诈率差异**：均衡。
- **可分离性差异**：前六个月存在，在剩余时间内消失。
- **描述**：该数据集引入了时间偏差，前六个月存在可分离性偏差，后两个月消失。这本质上是一个特征分布随时间变化的情景，确保变化的特征与受保护属性和目标变量相关。大多数现实世界中的模型都在高度动态的环境中运行，这使它们非常容易受到时间分布变化的影响。这一变体类似于欺诈检测中的一个常见现象：欺诈者对检测结果的适应行为。这意味着在一段时间内对欺诈检测有效的特征，可能会在欺诈者学会规避系统后变得无效。在该变体中，这些特征与受保护属性和目标相关，这可能导致性能与公平性权衡格局的巨大变化。

### 1.5 Train-Test Split
该文章推荐使用`month`进行划分，使用前六个月作为训练集，后两个月作为测试集。